buildscript {
  repositories {
    maven {
      url 'https://retail-bint.corp.apple.com/artifactory/jcenter-maven-virtual'
    }
  }
  dependencies {
    classpath 'com.gradle:build-scan-plugin:1.7.1'
    classpath 'org.jfrog.buildinfo:build-info-extractor-gradle:4.4.17'
    classpath 'com.moowork.gradle:gradle-node-plugin:1.1.1'

  }
}


apply plugin: 'maven-publish'
apply plugin: 'com.moowork.node'
apply plugin: 'com.moowork.gulp'
apply plugin: 'java'


description = 'seo-ui'
group = 'com.apple.store.content'




task npm(type: Exec) {
    description = "Grab NodeJS dependencies (from package.json)"
    commandLine = ["npm", "install"]
    inputs.file "package.json"
    outputs.dir "node_modules"
}


task npm_update(type: Exec) {
    description = "Grab NodeJS dependencies (from package.json)"
    commandLine = ["npm", "update"]
    // inputs.file "package.json"
    // outputs.dir "node_modules"
}

task gulpTest(type: GulpTask) {
  args = ["test"]
}

task gulpBuild(type: GulpTask) {
  args = ["build:skip"]
}

task copyTask(type: Copy) {
    from 'target/seo-ui'
    from 'target'
    into 'target-production'
    include('app.css','app.js','*.html','*.json')
    inputs.sourceFiles.stopExecutionIfEmpty()
    rename { String fileName ->
      fileName.replace("app.css", "app.min.css")
    }
    rename { String fileName ->
      fileName.replace("app.js", "app.min.js")
    }
  }

task anothercopyTask(type: Copy) {
    from 'target/seo-ui/'
    into 'target-production'
    include('app.css','app.js')
    from copyTask

  }

task npmBuild {
  dependsOn 'anothercopyTask'
  dependsOn 'gulpBuild'
  dependsOn 'gulpTest'
  dependsOn 'npm_update'
  dependsOn 'npm'
  tasks.findByName('npm').mustRunAfter 'npm_update'
  tasks.findByName('gulpTest').mustRunAfter 'npm'
  tasks.findByName('gulpBuild').mustRunAfter 'gulpTest'
  tasks.findByName('anothercopyTask').mustRunAfter 'gulpBuild'



}